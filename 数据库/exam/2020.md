2020 database

这是中国科学技术大学2019-2020学年第二学期《数据库系统及应用》课程的考试试卷。以下是对试卷中部分问题的答案和解释。

### 一、单项选择题
1. **A. 支持数据共享**
    - 相比文件系统，数据库技术的一个主要优点是支持数据共享。

2. **A. 元组**
    - 在关系数据模型中，现实世界中的一个实体通过元组表示。

3. **D. Check 约束**
    - Check 约束不能自动填充字段值，只能进行检查。

4. **B. 通过视图修改基本表结构**
    - 视图不能直接修改基本表的结构。

5. **A. 设计必要的存储过程和触发器**
    - 这是数据库逻辑设计阶段的任务，不是物理设计阶段的任务。

### 二、判断题
1. **√**
    - 可重复读隔离级别确保同一事务内多次读取同一数据返回相同的结果。

2. **×**
    - 如果DBMS不支持多粒度锁，则确实不需要实现意向锁。

3. **√**
    - 按照Redo日志，可以在write操作后立即将数据写入磁盘。

4. **×**
    - 强制访问控制和B1安全级别是高安全DBMS的要求，但不是所有安全DBMS都必须达到这些标准。

5. **×**
    - SQL基本表可以没有Primary Key约束，但一般情况下会有Unique约束。

6. **×**
    - 对用户使用的数据视图的描述称为外模式，不是概念模式。

7. **√**
    - 任何满足BCNF的关系模式也必定满足3NF。

8. **√**
    - SQL中的Foreign Key所引用的列必须有Unique或Primary Key约束。

9. **×**
    - ER模型中可以有只包含一个属性的实体。

10. **×**
    - 如果调度中的事务都遵循2PL，该调度必定是可串行化的。

### 三、数据库体系结构
1. **三级模式结构在SQL数据库中的实现**
    - **外模式**：用户视图，SQL中通过视图(View)实现。
    - **概念模式**：逻辑结构，SQL中通过表(Table)和关系(Relationship)实现。
    - **内模式**：物理存储结构，SQL中通过索引(Index)和存储结构(Storage Structures)实现。

2. **数据的逻辑独立性**
    - 数据的逻辑独立性是指在不改变外模式的情况下，修改概念模式而不影响应用程序。  
    - 例如：在数据库中增加一个新表，修改某些表的结构，但不改变现有应用程序对数据的访问和操作。

### 四、事务和日志
1. **事务日志记录事务的所有DML操作**
    - 事务日志通常记录所有DML操作，以便在发生故障时能够重做或撤销事务，确保数据的一致性和持久性。

2. **嵌套事务的支持问题**
    - **锁管理复杂**：嵌套事务需要复杂的锁管理策略，以避免死锁和确保一致性。
    - **恢复机制复杂**：需要为每个子事务维护独立的日志记录，增加了日志管理和恢复的复杂性。

3. **Redo日志和2PL的脏读问题**
    - **不会出现脏读问题**：2PL（Two-Phase Locking）协议确保事务的所有读写操作都在持有相应的锁期间进行，而Redo日志确保数据修改持久化，因此不会出现脏读问题。  
    - 证明：在2PL中，读操作必须等待写操作的锁释放，且Redo日志记录每次写操作，使得数据修改是可恢复的，不会产生脏读。

### 五、函数依赖和范式
给定关系模式 \( R(A, B, C, D, E) \) 和函数依赖集 \( F \):
\[ F = \{ A \rightarrow BD, BC \rightarrow D, DCE \rightarrow A, D \rightarrow B, E \rightarrow D \} \]

1. **最小函数依赖集**
    - \( \{ A \rightarrow B, A \rightarrow D, BC \rightarrow D, CE \rightarrow A, E \rightarrow D \} \)

2. **候选码**
    - **CE**：通过计算封闭集可以确认CE是候选码。

3. **范式**
    - \( R \) 满足BCNF，因为每个非平凡函数依赖的左边都是候选码的一部分。

4. **无损连接且保持函数依赖的分解到3NF**
    - 分解为 \( R1(A, B, D) \)、\( R2(C, E, A) \) 和 \( R3(B, C, D) \)。

### 六、SQL查询
1. **查询在“3C102”上课的所有姓“赵”的“计算机”系老师姓名**
    ```sql
    SELECT f.fname
    FROM course c
    JOIN faculty f ON c.fid = f.fid
    JOIN department d ON f.did = d.did
    WHERE c.room = '3C102' AND f.fname LIKE '赵%' AND d.dname = '计算机';
    ```

2. **查询选过课的学生中只选了“张三”老师所授课程的学生学号和姓名**
    ```sql
    SELECT s.sid, s.sname
    FROM student s
    WHERE s.sid IN (
        SELECT sc.sid
        FROM SC sc
        JOIN course c ON sc.cid = c.cid
        JOIN faculty f ON c.fid = f.fid
        WHERE f.fname = '张三'
    ) AND s.sid NOT IN (
        SELECT sc.sid
        FROM SC sc
        JOIN course c ON sc.cid = c.cid
        JOIN faculty f ON c.fid = f.fid
        WHERE f.fname != '张三'
    );
    ```

3. **查询每个系选修了“DB”课程但缺少成绩的学生人数**
    ```sql
    SELECT d.dname, COUNT(s.sid) AS student_count
    FROM student s
    JOIN department d ON s.did = d.did
    JOIN SC sc ON s.sid = sc.sid
    JOIN course c ON sc.cid = c.cid
    WHERE c.cname = 'DB' AND sc.score IS NULL
    GROUP BY d.dname
    ORDER BY student_count DESC;
    ```

4. **查询选修过“DB”和“AI”课程但“DB”课程成绩不低于“AI”成绩的学生学号和姓名**
    ```sql
    SELECT s.sid, s.sname
    FROM student s
    JOIN SC sc1 ON s.sid = sc1.sid
    JOIN course c1 ON sc1.cid = c1.cid
    JOIN SC sc2 ON s.sid = sc2.sid
    JOIN course c2 ON sc2.cid = c2.cid
    WHERE c1.cname = 'DB' AND c2.cname = 'AI' AND sc1.score >= sc2.score;
    ```

5. **查询选课数不少于4门并且各科成绩均不低于95的学生姓名、选修课程数和平均成绩**
    ```sql
    SELECT s.sname, COUNT(sc.cid) AS course_count, AVG(sc.score) AS avg_score
    FROM student s
    JOIN SC sc ON s.sid = sc.sid
    GROUP BY s.sname
    HAVING COUNT(sc.cid) >= 4 AND MIN(sc.score) >= 95;
    ```

### 七、ER图和关系模型

1. **ER图**
    - 需手绘ER图，包括实体（高校、学生、校长等）、属性（校名、ID、姓名等）和关系（高校包含学生和校长，学生与高校的关系，校长与高校的关系等）。

2. **关系模型**
    - **高校(University)**: `University(UID, UName)`
    - **学生(Student)**: `Student(SID, SName, EnrollmentDate, Status, FullTimeCredit, PartTimeHours)`
    - **校长(Principal)**: `Principal(PID, PName, UID)`
    - **学生会主席(Chairman)**: `Chairman(CID, SID, UID)`
    - **副主席(ViceChairman)**: `ViceChairman(VCID, SID, UID)`
    - **学生与高校关系(StudentUniversity)**: `StudentUniversity(SID, UID, EnrollmentDate, Role)`

以上是试卷中部分问题的答案和解释。完整作答需要基于对具体问题的详细分析和相应知识的应用。